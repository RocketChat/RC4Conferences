"""empty message

Revision ID: b2aca7268345
Revises: 4279c2ac565b
Create Date: 2019-06-13 13:27:39.773500

"""

from alembic import op
import sqlalchemy as sa
import sqlalchemy_utils


# revision identifiers, used by Alembic.
revision = 'b2aca7268345'
down_revision = '4279c2ac565b'


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.execute('ALTER TABLE events RENAME has_organizer_info TO has_owner_info')
    op.execute('ALTER TABLE events RENAME organizer_description TO owner_description')
    op.execute('ALTER TABLE events RENAME organizer_name TO owner_name')
    op.execute('ALTER TABLE events_version RENAME has_organizer_info TO has_owner_info')
    op.execute('ALTER TABLE events_version RENAME organizer_description TO owner_description')
    op.execute('ALTER TABLE events_version RENAME organizer_name TO owner_name')
    op.execute("INSERT INTO roles(name, title_name) SELECT 'owner', 'Owner' WHERE NOT EXISTS (SELECT id FROM roles WHERE name='owner')")
    op.execute("UPDATE users_events_roles SET role_id=(SELECT id FROM roles WHERE name='owner') WHERE id IN (SELECT DISTINCT ON(event_id, role_id) id FROM users_events_roles WHERE role_id=(SELECT id FROM roles WHERE name='organizer'))")
    # ### end Alembic commands ###


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.execute('ALTER TABLE events RENAME has_owner_info TO has_organizer_info')
    op.execute('ALTER TABLE events RENAME owner_description TO organizer_description')
    op.execute('ALTER TABLE events RENAME owner_name TO organizer_name')
    op.execute('ALTER TABLE events_version RENAME has_owner_info TO has_organizer_info')
    op.execute('ALTER TABLE events_version RENAME owner_description TO organizer_description')
    op.execute('ALTER TABLE events_version RENAME owner_name TO organizer_name')
    op.execute("UPDATE users_events_roles SET role_id=(SELECT id FROM roles WHERE name='organizer') WHERE role_id=(SELECT id FROM roles WHERE name='owner')")
    op.execute("DELETE FROM roles WHERE name='owner'")
    # ### end Alembic commands ###
